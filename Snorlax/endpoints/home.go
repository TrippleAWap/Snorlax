package endpoints

import (
	"net/http"
	"strings"
	"time"
)

var html = "<html lang=\"en\">\n\n<head>\n\t<meta charset=\"UTF-8\">\n\t<title>-</title>\n\t<link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\" rel=\"stylesheet\">\n\t<script src=\"https://cdn.tailwindcss.com\"></script>\n\t<link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css\" rel=\"stylesheet\">\n\t<script>\n\t\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\t\tfetch(\"/api/user\").then(r => r.json()).then(data => {\n\t\t\t\tdocument.querySelector('#user-name').innerHTML = data.displayName;\n\t\t\t}).catch(e => console.error(e));\n\n\t\t\tconst socket = new WebSocket(`ws://${document.URL.split(\"/\")[2]}/`)\n\t\t\tsocket.onmessage = (event) => {\n\t\t\t\tconst { eventId, data } = JSON.parse(event.data);\n\t\t\t\tswitch (eventId) {\n\t\t\t\t\tcase \"avatars\":\n\t\t\t\t\t\tconst [innerHtml, visibleCards, totalCards] = data;\n\t\t\t\t\t\tdocument.querySelector('#cards').innerHTML = innerHtml;\n\t\t\t\t\t\tdocument.querySelector('#displayed-text').innerHTML = `Showing ${visibleCards}/${totalCards}`\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error(`Unknown eventId: ${eventId}`, data);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsocket.onerror = (error) => {\n\t\t\t\tconsole.error('Socket error', error);\n\t\t\t\tdocument.querySelector('#error-display').style.display = 'block';\n\t\t\t\tdocument.querySelector('#error-message').textContent = 'Socket error'\n\t\t\t}\n\n\t\t\tconst searchBox = document.querySelector('input[type=\"text\"]');\n\t\t\t// check if cards has been updated;\n\t\t\t// on enter;\n\t\t\tsearchBox.addEventListener('keyup', async (event) => {\n\t\t\t\tif (event.keyCode === 13) {\n\t\t\t\t\tconsole.log('searching for', searchBox.value);\n\t\t\t\t\tconst [innerHtml, visibleCards, totalCards] = await updateFilter(searchBox.value);\n\t\t\t\t\tdocument.querySelector('#cards').innerHTML = innerHtml;\n\t\t\t\t\tdocument.querySelector('#avatar-visible-count').innerHTML = visibleCards.toString();\n\t\t\t\t\tdocument.querySelector('#avatar-count').innerHTML = totalCards.toString();\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t</script>\n</head>\n\n<body class=\"bg-zinc-900\">\n<div class=\"relative bg-zinc-800 py-5\">\n\t<!-- Header Section -->\n\t<div class=\"text-center\">\n\t\t<img src=\"https://files.catbox.moe/np540j.png\" alt=\"Logo\" class=\"mx-auto w-24 h\t-24\">\n\t\t<h1 class=\"text-3xl font-bold text-white mt-2\">Snorlax</h1>\n\t</div>\n\n\t<!-- Logged-in User Text -->\n\t<p class=\"absolute top-5 right-5 text-gray-400 text-sm\">\n\t\tLogged in as <span style=\"font-weight: bold; color: #9b77ff;\" id=\"user-name\">Unknown</span>\n\t</p>\n\n\t<!-- Search Section -->\n\t<div class=\"flex items-center w-3/4 mx-auto mt-5 space-x-2\">\n\t\t<i class=\"fa fa-search text-gray-400 text-lg\"></i>\n\t\t<input type=\"text\" placeholder=\"Filter by text\"\n\t\t\t   class=\"bg-zinc-700 text-white py-2 px-4 rounded-lg w-full text-sm outline-none\">\n\t\t<p class=\"text-gray-400 text-sm\" style=\"justify-content: center; display: flex; text-align: center;\" id=\"displayed-text\">Showing 0/0</p>\n\t</div>\n</div>\n\n<!-- Error Display Section -->\n<div class=\"bg-red-900 text-white p-2 hover:bg-red-700 rounded-sm mb-5 transition-all duration-300\"\n\t id=\"error-display\" style=\"display: none;\">\n\t<p class=\"text-sm font-bold mb-1\">Error</p>\n\t<p class=\"text-sm mt-1\" id=\"error-message\"></p>\n</div>\n\n<!-- Cards Section -->\n<div class=\"flex flex-wrap items-center justify-center -mx-0 mt-5\" id=\"cards\">\n\t<!-- Cards -->\n</div>\n</body>\n\n\n</html>"

func init() {
	RegisterEndpoint("home", func(w http.ResponseWriter, r *http.Request) {
		//http.ServeFile(w, r, "static/index.html")
		http.ServeContent(w, r, "index.html", time.Now(), strings.NewReader(html))
	})
}
